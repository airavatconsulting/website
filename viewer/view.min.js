window.libpannellum=function(J,f,w){function $t(H){function pt(a,r){return a.level==1&&r.level!=1?-1:r.level==1&&a.level!=1?1:r.timestamp-a.timestamp}function et(a,r){return a.level!=r.level?a.level-r.level:a.diff-r.diff}function vt(a,r,L,y,u,s){this.vertices=a,this.side=r,this.level=L,this.x=y,this.y=u,this.path=s.replace("%s",r).replace("%l",L).replace("%x",y).replace("%y",u)}function Xt(a,r,L,y,u){var s,x=r.vertices;s=_t(a,x.slice(0,3));var l=_t(a,x.slice(3,6)),R=_t(a,x.slice(6,9)),x=_t(a,x.slice(9,12)),E=s[0]+l[0]+R[0]+x[0];if(E==-4||E==4?s=!1:(E=s[1]+l[1]+R[1]+x[1],s=E==-4||E==4?!1:s[2]+l[2]+R[2]+x[2]!=4),s){for(s=r.vertices,l=s[0]+s[3]+s[6]+s[9],R=s[1]+s[4]+s[7]+s[10],x=s[2]+s[5]+s[8]+s[11],E=Math.sqrt(l*l+R*R+x*x),x=Math.asin(x/E),l=Math.atan2(R,l)-y,l+=l>Math.PI?-2*Math.PI:l<-Math.PI?2*Math.PI:0,l=Math.abs(l),r.diff=Math.acos(Math.sin(L)*Math.sin(x)+Math.cos(L)*Math.cos(x)*Math.cos(l)),l=!1,R=0;R<h.nodeCache.length;R++)if(h.nodeCache[R].path==r.path){l=!0,h.nodeCache[R].timestamp=h.nodeCacheTimestamp++,h.nodeCache[R].diff=r.diff,h.currentNodes.push(h.nodeCache[R]);break}if(l||(r.timestamp=h.nodeCacheTimestamp++,h.currentNodes.push(r),h.nodeCache.push(r)),r.level<h.level){var x=p.cubeResolution*Math.pow(2,r.level-p.maxLevel),l=Math.ceil(x*p.invTileResolution)-1,R=x%p.tileResolution*2,D=2*x%p.tileResolution;D===0&&(D=p.tileResolution),R===0&&(R=2*p.tileResolution),E=.5,(r.x==l||r.y==l)&&(E=1-p.tileResolution/(p.tileResolution+D));var I=1-E,x=[],Y=E,W=E,O=E,F=I,m=I,N=I;for(D<p.tileResolution&&(r.x==l&&r.y!=l?(m=W=.5,(r.side=="d"||r.side=="u")&&(N=O=.5)):r.x!=l&&r.y==l&&(F=Y=.5,r.side=="l"||r.side=="r")&&(N=O=.5)),R<=p.tileResolution&&(r.x==l&&(Y=0,F=1,r.side=="l"||r.side=="r")&&(O=0,N=1),r.y==l&&(W=0,m=1,r.side=="d"||r.side=="u")&&(O=0,N=1)),D=[s[0],s[1],s[2],s[0]*Y+s[3]*F,s[1]*E+s[4]*I,s[2]*O+s[5]*N,s[0]*Y+s[6]*F,s[1]*W+s[7]*m,s[2]*O+s[8]*N,s[0]*E+s[9]*I,s[1]*W+s[10]*m,s[2]*O+s[11]*N],D=new vt(D,r.side,r.level+1,2*r.x,2*r.y,p.fullpath),x.push(D),r.x==l&&R<=p.tileResolution||(D=[s[0]*Y+s[3]*F,s[1]*E+s[4]*I,s[2]*O+s[5]*N,s[3],s[4],s[5],s[3]*E+s[6]*I,s[4]*W+s[7]*m,s[5]*O+s[8]*N,s[0]*Y+s[6]*F,s[1]*W+s[7]*m,s[2]*O+s[8]*N],D=new vt(D,r.side,r.level+1,2*r.x+1,2*r.y,p.fullpath),x.push(D)),r.x==l&&R<=p.tileResolution||r.y==l&&R<=p.tileResolution||(D=[s[0]*Y+s[6]*F,s[1]*W+s[7]*m,s[2]*O+s[8]*N,s[3]*E+s[6]*I,s[4]*W+s[7]*m,s[5]*O+s[8]*N,s[6],s[7],s[8],s[9]*Y+s[6]*F,s[10]*E+s[7]*I,s[11]*O+s[8]*N],D=new vt(D,r.side,r.level+1,2*r.x+1,2*r.y+1,p.fullpath),x.push(D)),r.y==l&&R<=p.tileResolution||(D=[s[0]*E+s[9]*I,s[1]*W+s[10]*m,s[2]*O+s[11]*N,s[0]*Y+s[6]*F,s[1]*W+s[7]*m,s[2]*O+s[8]*N,s[9]*Y+s[6]*F,s[10]*E+s[7]*I,s[11]*O+s[8]*N,s[9],s[10],s[11]],D=new vt(D,r.side,r.level+1,2*r.x,2*r.y+1,p.fullpath),x.push(D)),r=0;r<x.length;r++)Xt(a,x[r],L,y,u)}}}function Lt(){return[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1]}function It(a,r,L){var y=Math.sin(r);if(r=Math.cos(r),L=="x")return[a[0],r*a[1]+y*a[2],r*a[2]-y*a[1],a[3],r*a[4]+y*a[5],r*a[5]-y*a[4],a[6],r*a[7]+y*a[8],r*a[8]-y*a[7]];if(L=="y")return[r*a[0]-y*a[2],a[1],r*a[2]+y*a[0],r*a[3]-y*a[5],a[4],r*a[5]+y*a[3],r*a[6]-y*a[8],a[7],r*a[8]+y*a[6]];if(L=="z")return[r*a[0]+y*a[1],r*a[1]-y*a[0],a[2],r*a[3]+y*a[4],r*a[4]-y*a[3],a[5],r*a[6]+y*a[7],r*a[7]-y*a[6],a[8]]}function Rt(a){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]]}function kt(a){Wt(a,a.path+"."+p.extension,function(r,L){a.texture=r,a.textureLoaded=L?2:1},At.crossOrigin)}function _t(a,r){var u=[a[0]*r[0]+a[1]*r[1]+a[2]*r[2],a[4]*r[0]+a[5]*r[1]+a[6]*r[2],a[11]+a[8]*r[0]+a[9]*r[1]+a[10]*r[2],1/(a[12]*r[0]+a[13]*r[1]+a[14]*r[2])],L=u[0]*u[3],y=u[1]*u[3],u=u[2]*u[3],s=[0,0,0];return-1>L&&(s[0]=-1),1<L&&(s[0]=1),-1>y&&(s[1]=-1),1<y&&(s[1]=1),(-1>u||1<u)&&(s[2]=1),s}function Ut(){console.log("Reducing canvas size due to error 1286!"),B.width=Math.round(B.width/2),B.height=Math.round(B.height/2)}var B=f.createElement("canvas");B.style.width=B.style.height="100%",H.appendChild(B);var h,n,ot,nt,ct,Q,St,yt,p,U,z,gt,Ft,at,Tt,At;this.init=function(a,r,L,y,u,s,l,R){function x(F){if(D){var m=F*F*4,N=new Uint8ClampedArray(m),X=R.backgroundColor?R.backgroundColor:[0,0,0];X[0]*=255,X[1]*=255,X[2]*=255;for(var t=0;t<m;t++)N[t++]=X[0],N[t++]=X[1],N[t++]=X[2];for(F=new ImageData(N,F,F),E=0;6>E;E++)p[E].width==0&&(p[E]=F)}}if(r===w&&(r="equirectangular"),r!="equirectangular"&&r!="cubemap"&&r!="multires")throw console.log("Error: invalid image type specified!"),{type:"config error"};if(U=r,p=a,z=L,At=R||{},h){if(ot&&(n.detachShader(h,ot),n.deleteShader(ot)),nt&&(n.detachShader(h,nt),n.deleteShader(nt)),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),h.texture&&n.deleteTexture(h.texture),h.nodeCache)for(a=0;a<h.nodeCache.length;a++)n.deleteTexture(h.nodeCache[a].texture);n.deleteProgram(h),h=w}yt=w;var E,D=!1,I;if(U=="cubemap")for(E=0;6>E;E++)0<p[E].width?(I===w&&(I=p[E].width),I!=p[E].width&&console.log("Cube faces have inconsistent widths: "+I+" vs. "+p[E].width)):D=!0;if(U=="cubemap"&&I&I-1&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(n||(n=B.getContext("experimental-webgl",{alpha:!1,depth:!1})),n&&n.getError()==1286&&Ut()),!n&&(U=="multires"&&p.hasOwnProperty("fallbackPath")||U=="cubemap")&&("WebkitAppearance"in f.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||navigator.appVersion.indexOf("MSIE 10")!==-1)){Q&&H.removeChild(Q),Q=f.createElement("div"),Q.className="pnlm-world",y=p.basePath?p.basePath+p.fallbackPath:p.fallbackPath;var Y="frblud".split(""),W=0;u=function(){var m=f.createElement("canvas");m.className="pnlm-face pnlm-"+Y[this.side]+"face",Q.appendChild(m);var N=m.getContext("2d");m.style.width=this.width+4+"px",m.style.height=this.height+4+"px",m.width=this.width+4,m.height=this.height+4,N.drawImage(this,2,2);var X=N.getImageData(0,0,m.width,m.height),t=X.data,M,P;for(M=2;M<m.width-2;M++)for(P=0;4>P;P++)t[4*(M+m.width)+P]=t[4*(M+2*m.width)+P],t[4*(M+m.width*(m.height-2))+P]=t[4*(M+m.width*(m.height-3))+P];for(M=2;M<m.height-2;M++)for(P=0;4>P;P++)t[4*(M*m.width+1)+P]=t[4*(M*m.width+2)+P],t[4*((M+1)*m.width-2)+P]=t[4*((M+1)*m.width-3)+P];for(P=0;4>P;P++)t[4*(m.width+1)+P]=t[4*(2*m.width+2)+P],t[4*(2*m.width-2)+P]=t[4*(3*m.width-3)+P],t[4*(m.width*(m.height-2)+1)+P]=t[4*(m.width*(m.height-3)+2)+P],t[4*(m.width*(m.height-1)-2)+P]=t[4*(m.width*(m.height-2)-3)+P];for(M=1;M<m.width-1;M++)for(P=0;4>P;P++)t[4*M+P]=t[4*(M+m.width)+P],t[4*(M+m.width*(m.height-1))+P]=t[4*(M+m.width*(m.height-2))+P];for(M=1;M<m.height-1;M++)for(P=0;4>P;P++)t[M*m.width*4+P]=t[4*(M*m.width+1)+P],t[4*((M+1)*m.width-1)+P]=t[4*((M+1)*m.width-2)+P];for(P=0;4>P;P++)t[P]=t[4*(m.width+1)+P],t[4*(m.width-1)+P]=t[4*(2*m.width-2)+P],t[m.width*(m.height-1)*4+P]=t[4*(m.width*(m.height-2)+1)+P],t[4*(m.width*m.height-1)+P]=t[4*(m.width*(m.height-1)-2)+P];N.putImageData(X,0,0),O.call(this)};var O=function(){0<this.width?(ct===w&&(ct=this.width),ct!=this.width&&console.log("Fallback faces have inconsistent widths: "+ct+" vs. "+this.width)):D=!0,W++,W==6&&(ct=this.width,H.appendChild(Q),l())},D=!1;for(E=0;6>E;E++)s=new Image,s.crossOrigin=At.crossOrigin?At.crossOrigin:"anonymous",s.side=E,s.onload=u,s.onerror=O,s.src=U=="multires"?y.replace("%s",Y[E])+"."+p.extension:p[E].src;x(ct)}else{if(!n)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};for(U=="cubemap"&&x(I),p.fullpath=p.basePath?p.basePath+p.path:p.path,p.invTileResolution=1/p.tileResolution,a=Lt(),St=[],E=0;6>E;E++)St[E]=a.slice(12*E,12*E+12),a=Lt();if(a=0,U=="equirectangular"){if(a=n.getParameter(n.MAX_TEXTURE_SIZE),Math.max(p.width/2,p.height)>a)throw console.log("Error: The image is too big; it's "+p.width+"px wide, but this device's maximum supported size is "+2*a+"px."),{type:"webgl size error",width:p.width,maxWidth:2*a}}else if(U=="cubemap"&&I>n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+I+"px wide, but this device's maximum supported size is "+a+"px."),{type:"webgl size error",width:I,maxWidth:a};if(R===w||R.horizonPitch===w&&R.horizonRoll===w||(yt=[R.horizonPitch==w?0:R.horizonPitch,R.horizonRoll==w?0:R.horizonRoll]),I=n.TEXTURE_2D,n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.getShaderPrecisionFormat&&(r=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT))&&1>r.precision&&(bt=bt.replace("highp","mediump")),ot=n.createShader(n.VERTEX_SHADER),r=A,U=="multires"&&(r=S),n.shaderSource(ot,r),n.compileShader(ot),nt=n.createShader(n.FRAGMENT_SHADER),r=Pt,U=="cubemap"?(I=n.TEXTURE_CUBE_MAP,r=Mt):U=="multires"&&(r=Kt),n.shaderSource(nt,r),n.compileShader(nt),h=n.createProgram(),n.attachShader(h,ot),n.attachShader(h,nt),n.linkProgram(h),n.getShaderParameter(ot,n.COMPILE_STATUS)||console.log(n.getShaderInfoLog(ot)),n.getShaderParameter(nt,n.COMPILE_STATUS)||console.log(n.getShaderInfoLog(nt)),n.getProgramParameter(h,n.LINK_STATUS)||console.log(n.getProgramInfoLog(h)),n.useProgram(h),h.drawInProgress=!1,r=R.backgroundColor?R.backgroundColor:[0,0,0],n.clearColor(r[0],r[1],r[2],1),n.clear(n.COLOR_BUFFER_BIT),h.texCoordLocation=n.getAttribLocation(h,"a_texCoord"),n.enableVertexAttribArray(h.texCoordLocation),U!="multires"?(gt||(gt=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,gt),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),n.STATIC_DRAW),n.vertexAttribPointer(h.texCoordLocation,2,n.FLOAT,!1,0,0),h.aspectRatio=n.getUniformLocation(h,"u_aspectRatio"),n.uniform1f(h.aspectRatio,n.drawingBufferWidth/n.drawingBufferHeight),h.psi=n.getUniformLocation(h,"u_psi"),h.theta=n.getUniformLocation(h,"u_theta"),h.f=n.getUniformLocation(h,"u_f"),h.h=n.getUniformLocation(h,"u_h"),h.v=n.getUniformLocation(h,"u_v"),h.vo=n.getUniformLocation(h,"u_vo"),h.rot=n.getUniformLocation(h,"u_rot"),n.uniform1f(h.h,y/(2*Math.PI)),n.uniform1f(h.v,u/Math.PI),n.uniform1f(h.vo,s/Math.PI*2),U=="equirectangular"&&(h.backgroundColor=n.getUniformLocation(h,"u_backgroundColor"),n.uniform4fv(h.backgroundColor,r.concat([1]))),h.texture=n.createTexture(),n.bindTexture(I,h.texture),U=="cubemap"?(n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p[1]),n.texImage2D(n.TEXTURE_CUBE_MAP_NEGATIVE_X,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p[3]),n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_Y,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p[4]),n.texImage2D(n.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p[5]),n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_Z,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p[0]),n.texImage2D(n.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p[2])):p.width<=a?(n.uniform1i(n.getUniformLocation(h,"u_splitImage"),0),n.texImage2D(I,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p)):(n.uniform1i(n.getUniformLocation(h,"u_splitImage"),1),y=f.createElement("canvas"),y.width=p.width/2,y.height=p.height,y=y.getContext("2d"),y.drawImage(p,0,0),u=y.getImageData(0,0,p.width/2,p.height),n.texImage2D(I,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,u),h.texture2=n.createTexture(),n.activeTexture(n.TEXTURE1),n.bindTexture(I,h.texture2),n.uniform1i(n.getUniformLocation(h,"u_image1"),1),y.drawImage(p,-p.width/2,0),u=y.getImageData(0,0,p.width/2,p.height),n.texImage2D(I,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,u),n.texParameteri(I,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(I,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(I,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(I,n.TEXTURE_MAG_FILTER,n.LINEAR),n.activeTexture(n.TEXTURE0)),n.texParameteri(I,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(I,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(I,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(I,n.TEXTURE_MAG_FILTER,n.LINEAR)):(h.vertPosLocation=n.getAttribLocation(h,"a_vertCoord"),n.enableVertexAttribArray(h.vertPosLocation),Ft||(Ft=n.createBuffer()),at||(at=n.createBuffer()),Tt||(Tt=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,at),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,Tt),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),n.STATIC_DRAW),h.perspUniform=n.getUniformLocation(h,"u_perspMatrix"),h.cubeUniform=n.getUniformLocation(h,"u_cubeMatrix"),h.level=-1,h.currentNodes=[],h.nodeCache=[],h.nodeCacheTimestamp=0),y=n.getError(),y!==0)throw console.log("Error: Something went wrong with WebGL!",y),{type:"webgl error"};l()}},this.destroy=function(){if(H!==w&&(B!==w&&H.contains(B)&&H.removeChild(B),Q!==w&&H.contains(Q)&&H.removeChild(Q)),n){var a=n.getExtension("WEBGL_lose_context");a&&a.loseContext()}},this.resize=function(){var a=J.devicePixelRatio||1;B.width=B.clientWidth*a,B.height=B.clientHeight*a,n&&(n.getError()==1286&&Ut(),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),U!="multires"&&n.uniform1f(h.aspectRatio,B.clientWidth/B.clientHeight))},this.resize(),this.setPose=function(a,r){yt=[a,r]},this.render=function(a,r,L,y){var u,s=0;if(y===w&&(y={}),y.roll&&(s=y.roll),yt!==w){u=yt[0];var l=yt[1],R=a,x=r,E=Math.cos(l)*Math.sin(a)*Math.sin(u)+Math.cos(a)*(Math.cos(u)*Math.cos(r)+Math.sin(l)*Math.sin(u)*Math.sin(r)),D=-Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.sin(r);a=Math.cos(l)*Math.cos(u)*Math.sin(a)+Math.cos(a)*(-Math.cos(r)*Math.sin(u)+Math.cos(u)*Math.sin(l)*Math.sin(r)),a=Math.asin(Math.max(Math.min(a,1),-1)),r=Math.atan2(D,E),u=[Math.cos(R)*(Math.sin(l)*Math.sin(u)*Math.cos(x)-Math.cos(u)*Math.sin(x)),Math.cos(R)*Math.cos(l)*Math.cos(x),Math.cos(R)*(Math.cos(u)*Math.sin(l)*Math.cos(x)+Math.sin(x)*Math.sin(u))],l=[-Math.cos(a)*Math.sin(r),Math.cos(a)*Math.cos(r)],l=Math.acos(Math.max(Math.min((u[0]*l[0]+u[1]*l[1])/(Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])*Math.sqrt(l[0]*l[0]+l[1]*l[1])),1),-1)),0>u[2]&&(l=2*Math.PI-l),s+=l}if(n||U!="multires"&&U!="cubemap"){if(U!="multires")L=2*Math.atan(Math.tan(.5*L)/(n.drawingBufferWidth/n.drawingBufferHeight)),L=1/Math.tan(.5*L),n.uniform1f(h.psi,r),n.uniform1f(h.theta,a),n.uniform1f(h.rot,s),n.uniform1f(h.f,L),z===!0&&U=="equirectangular"&&(n.bindTexture(n.TEXTURE_2D,h.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,p)),n.drawArrays(n.TRIANGLES,0,6);else{for(u=n.drawingBufferWidth/n.drawingBufferHeight,l=2*Math.atan(Math.tan(L/2)*n.drawingBufferHeight/n.drawingBufferWidth),l=1/Math.tan(l/2),u=[l/u,0,0,0,0,l,0,0,0,0,100.1/-99.9,20/-99.9,0,0,-1,0],l=1;l<p.maxLevel&&n.drawingBufferWidth>p.tileResolution*Math.pow(2,l-1)*Math.tan(L/2)*.707;)l++;if(h.level=l,l=[1,0,0,0,1,0,0,0,1],l=It(l,-s,"z"),l=It(l,-a,"x"),l=It(l,r,"y"),l=[l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1],n.uniformMatrix4fv(h.perspUniform,!1,new Float32Array(Rt(u))),n.uniformMatrix4fv(h.cubeUniform,!1,new Float32Array(Rt(l))),s=[u[0]*l[0],u[0]*l[1],u[0]*l[2],0,u[5]*l[4],u[5]*l[5],u[5]*l[6],0,u[10]*l[8],u[10]*l[9],u[10]*l[10],u[11],-l[8],-l[9],-l[10],0],h.nodeCache.sort(pt),200<h.nodeCache.length&&h.nodeCache.length>h.currentNodes.length+50)for(u=h.nodeCache.splice(200,h.nodeCache.length-200),l=0;l<u.length;l++)n.deleteTexture(u[l].texture);for(h.currentNodes=[],l="fbudlr".split(""),u=0;6>u;u++)R=new vt(St[u],l[u],1,0,0,p.fullpath),Xt(s,R,a,r,L);for(h.currentNodes.sort(et),a=ut.length-1;0<=a;a--)h.currentNodes.indexOf(ut[a].node)===-1&&(ut[a].node.textureLoad=!1,ut.splice(a,1));if(ut.length===0){for(a=0;a<h.currentNodes.length;a++)if(r=h.currentNodes[a],!r.texture&&!r.textureLoad){r.textureLoad=!0,setTimeout(kt,0,r);break}}if(!h.drawInProgress){for(h.drawInProgress=!0,n.clear(n.COLOR_BUFFER_BIT),a=0;a<h.currentNodes.length;a++)1<h.currentNodes[a].textureLoaded&&(n.bindBuffer(n.ARRAY_BUFFER,Ft),n.bufferData(n.ARRAY_BUFFER,new Float32Array(h.currentNodes[a].vertices),n.STATIC_DRAW),n.vertexAttribPointer(h.vertPosLocation,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,at),n.vertexAttribPointer(h.texCoordLocation,2,n.FLOAT,!1,0,0),n.bindTexture(n.TEXTURE_2D,h.currentNodes[a].texture),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0));h.drawInProgress=!1}}if(y.returnImage!==w)return B.toDataURL("image/png")}else for(u=ct/2,y={f:"translate3d(-"+(u+2)+"px, -"+(u+2)+"px, -"+u+"px)",b:"translate3d("+(u+2)+"px, -"+(u+2)+"px, "+u+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(u+2)+"px, -"+u+"px, "+(u+2)+"px) rotateX(270deg)",d:"translate3d(-"+(u+2)+"px, "+u+"px, -"+(u+2)+"px) rotateX(90deg)",l:"translate3d(-"+u+"px, -"+(u+2)+"px, "+(u+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+u+"px, -"+(u+2)+"px, -"+(u+2)+"px) rotateY(270deg)"},L=1/Math.tan(L/2),L=L*B.clientWidth/2+"px",r="perspective("+L+") translateZ("+L+") rotateX("+a+"rad) rotateY("+r+"rad) ",L=Object.keys(y),a=0;6>a;a++)(s=Q.querySelector(".pnlm-"+L[a]+"face"))&&(s.style.webkitTransform=r+y[L[a]],s.style.transform=r+y[L[a]])},this.isLoading=function(){if(n&&U=="multires"){for(var a=0;a<h.currentNodes.length;a++)if(!h.currentNodes[a].textureLoaded)return!0}return!1},this.getCanvas=function(){return B};var ut=[],Wt=function(){function a(){var l=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=u||"anonymous";var R=function(){if(0<l.image.width&&0<l.image.height){var x=l.image;n.bindTexture(n.TEXTURE_2D,l.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,x),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),l.callback(l.texture,!0)}else l.callback(l.texture,!1);ut.length?(x=ut.shift(),l.loadTexture(x.src,x.texture,x.callback)):y[L++]=l};this.image.addEventListener("load",R),this.image.addEventListener("error",R)}function r(l,R,x,E){this.node=l,this.src=R,this.texture=x,this.callback=E}var L=4,y={},u;a.prototype.loadTexture=function(l,R,x){this.texture=R,this.callback=x,this.image.src=l};for(var s=0;s<L;s++)y[s]=new a;return function(l,R,x,E){return u=E,E=n.createTexture(),L?y[--L].loadTexture(R,E,x):ut.push(new r(l,R,E,x)),E}}()}var A="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",S="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",bt=`precision highp float;
uniform float u_aspectRatio;
uniform float u_psi;
uniform float u_theta;
uniform float u_f;
uniform float u_h;
uniform float u_v;
uniform float u_vo;
uniform float u_rot;
const float PI = 3.14159265358979323846264;
uniform sampler2D u_image0;
uniform sampler2D u_image1;
uniform bool u_splitImage;
uniform samplerCube u_imageCube;
varying vec2 v_texCoord;
uniform vec4 u_backgroundColor;
void main() {
float x = v_texCoord.x * u_aspectRatio;
float y = v_texCoord.y;
float sinrot = sin(u_rot);
float cosrot = cos(u_rot);
float rot_x = x * cosrot - y * sinrot;
float rot_y = x * sinrot + y * cosrot;
float sintheta = sin(u_theta);
float costheta = cos(u_theta);
float a = u_f * costheta - rot_y * sintheta;
float root = sqrt(rot_x * rot_x + a * a);
float lambda = atan(rot_x / root, a / root) + u_psi;
float phi = atan((rot_y * costheta + u_f * sintheta) / root);`,Mt=bt+`float cosphi = cos(phi);
gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));
}`,Pt=bt+`lambda = mod(lambda + PI, PI * 2.0) - PI;
vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));
if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)
gl_FragColor = u_backgroundColor;
else {
if(u_splitImage) {
if(coord.x < 0.0)
gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));
else
gl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));
} else {
gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));
}
}
}`,Kt="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(H,pt,et,vt){return new $t(H,pt,et,vt)}}}(window,document),window.pannellum=function(J,f,w){function $t(A,S){function bt(){var e=f.createElement("div");if(e.innerHTML="<!--[if lte IE 9]><i></i><![endif]-->",e.getElementsByTagName("i").length==1)H();else{Ct=t.hfov,Ht=t.pitch;var o;if(t.type=="cubemap"){for($=[],e=0;6>e;e++)$.push(new Image),$[e].crossOrigin=t.crossOrigin;g.load.lbox.style.display="block",g.load.lbar.style.display="none"}else if(t.type=="multires")e=JSON.parse(JSON.stringify(t.multiRes)),t.basePath&&t.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(t.multiRes.basePath)?e.basePath=t.basePath+t.multiRes.basePath:t.multiRes.basePath?e.basePath=t.multiRes.basePath:t.basePath&&(e.basePath=t.basePath),$=e;else if(t.dynamic===!0)$=t.panorama;else{if(t.panorama===w){H(t.strings.noPanoramaError);return}$=new Image}if(t.type=="cubemap")for(var i=6,c=function(){i--,i===0&&Pt()},d=function(lt){var K=f.createElement("a");K.href=lt.target.src,K.textContent=K.href,H(t.strings.fileAccessError.replace("%s",K.outerHTML))},e=0;e<$.length;e++)o=t.cubeMap[e],o=="null"?(console.log("Will use background instead of missing cubemap face "+e),c()):(t.basePath&&!Mt(o)&&(o=t.basePath+o),$[e].onload=c,$[e].onerror=d,$[e].src=F(o));else if(t.type=="multires")Pt();else if(o="",t.basePath&&(o=t.basePath),t.dynamic!==!0){o=Mt(t.panorama)?t.panorama:o+t.panorama,$.onload=function(){J.URL.revokeObjectURL(this.src),Pt()};var v=new XMLHttpRequest;v.onloadend=function(){if(v.status!=200){var _=f.createElement("a");_.href=o,_.textContent=_.href,H(t.strings.fileAccessError.replace("%s",_.outerHTML))}Kt(this.response),g.load.msg.innerHTML=""},v.onprogress=function(_){if(_.lengthComputable){g.load.lbarFill.style.width=_.loaded/_.total*100+"%";var lt,K;1e6<_.total?(lt="MB",K=(_.loaded/1e6).toFixed(2),_=(_.total/1e6).toFixed(2)):1e3<_.total?(lt="kB",K=(_.loaded/1e3).toFixed(1),_=(_.total/1e3).toFixed(1)):(lt="B",K=_.loaded,_=_.total),g.load.msg.innerHTML=K+" / "+_+" "+lt}else g.load.lbox.style.display="block",g.load.lbar.style.display="none"};try{v.open("GET",o,!0)}catch{H(t.strings.malformedURLError)}v.responseType="blob",v.setRequestHeader("Accept","image/*,*/*;q=0.9"),v.withCredentials=t.crossOrigin==="use-credentials",v.send()}t.draggable&&k.classList.add("pnlm-grab"),k.classList.remove("pnlm-grabbing"),Jt=t.dynamicUpdate===!0,t.dynamic&&Jt&&($=t.panorama,Pt())}}function Mt(e){return/^(?:[a-z]+:)?\/\//i.test(e)||e[0]=="/"||e.slice(0,5)=="blob:"}function Pt(){M||(M=new libpannellum.renderer(q)),Qt||(Qt=!0,it.addEventListener("mousedown",vt,!1),f.addEventListener("mousemove",It,!1),f.addEventListener("mouseup",Rt,!1),t.mouseZoom&&(k.addEventListener("mousewheel",ot,!1),k.addEventListener("DOMMouseScroll",ot,!1)),t.doubleClickZoom&&it.addEventListener("dblclick",Xt,!1),A.addEventListener("mozfullscreenchange",l,!1),A.addEventListener("webkitfullscreenchange",l,!1),A.addEventListener("msfullscreenchange",l,!1),A.addEventListener("fullscreenchange",l,!1),J.addEventListener("resize",U,!1),J.addEventListener("orientationchange",U,!1),t.disableKeyboardCtrl||(A.addEventListener("keydown",nt,!1),A.addEventListener("keyup",Q,!1),A.addEventListener("blur",ct,!1)),f.addEventListener("mouseleave",Rt,!1),f.documentElement.style.pointerAction===""&&f.documentElement.style.touchAction===""?(it.addEventListener("pointerdown",B,!1),it.addEventListener("pointermove",h,!1),it.addEventListener("pointerup",n,!1),it.addEventListener("pointerleave",n,!1)):(it.addEventListener("touchstart",kt,!1),it.addEventListener("touchmove",_t,!1),it.addEventListener("touchend",Ut,!1)),J.navigator.pointerEnabled&&(A.style.touchAction="none")),At(),x(t.hfov),setTimeout(function(){},500)}function Kt(e){var o=new FileReader;o.addEventListener("loadend",function(){var i=o.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var c=i.indexOf("\xFF\xC2");(0>c||65536<c)&&H(t.strings.iOS8WebGLError)}if(c=i.indexOf("<x:xmpmeta"),-1<c&&t.ignoreGPanoXMP!==!0){var d=i.substring(c,i.indexOf("</x:xmpmeta>")+12),j=function(Ot){var mt;return 0<=d.indexOf(Ot+'="')?(mt=d.substring(d.indexOf(Ot+'="')+Ot.length+2),mt=mt.substring(0,mt.indexOf('"'))):0<=d.indexOf(Ot+">")&&(mt=d.substring(d.indexOf(Ot+">")+Ot.length+1),mt=mt.substring(0,mt.indexOf("<"))),mt!==w?Number(mt):null},i=j("GPano:FullPanoWidthPixels"),c=j("GPano:CroppedAreaImageWidthPixels"),v=j("GPano:FullPanoHeightPixels"),_=j("GPano:CroppedAreaImageHeightPixels"),lt=j("GPano:CroppedAreaTopPixels"),K=j("GPano:PoseHeadingDegrees"),ht=j("GPano:PosePitchDegrees"),j=j("GPano:PoseRollDegrees");i!==null&&c!==null&&v!==null&&_!==null&&lt!==null&&(0>ft.indexOf("haov")&&(t.haov=c/i*360),0>ft.indexOf("vaov")&&(t.vaov=_/v*180),0>ft.indexOf("vOffset")&&(t.vOffset=-180*((lt+_/2)/v-.5)),K!==null&&0>ft.indexOf("northOffset")&&(t.northOffset=K,t.compass!==!1&&(t.compass=!0)),ht!==null&&j!==null&&(0>ft.indexOf("horizonPitch")&&(t.horizonPitch=ht),0>ft.indexOf("horizonRoll")&&(t.horizonRoll=j)))}$.src=J.URL.createObjectURL(e)}),o.readAsBinaryString!==w?o.readAsBinaryString(e):o.readAsText(e)}function H(e){e===w&&(e=t.strings.genericWebGLError),g.errorMsg.innerHTML="<p>"+e+"</p>",T.load.style.display="none",g.load.box.style.display="none",g.errorMsg.style.display="table",Vt=!0,G=w,q.style.display="none",N("error",e)}function pt(e){var o=et(e);wt.style.left=o.x+"px",wt.style.top=o.y+"px",clearTimeout(pt.t1),clearTimeout(pt.t2),wt.style.display="block",wt.style.opacity=1,pt.t1=setTimeout(function(){wt.style.opacity=0},2e3),pt.t2=setTimeout(function(){wt.style.display="none"},2500),e.preventDefault()}function et(e){var o=A.getBoundingClientRect(),i={};return i.x=(e.clientX||e.pageX)-o.left,i.y=(e.clientY||e.pageY)-o.top,i}function vt(e){if(e.preventDefault(),A.focus(),G&&t.draggable){var o=et(e);if(t.hotSpotDebug){var i=Lt(e);console.log("Pitch: "+i[0]+", Yaw: "+i[1]+", Center Pitch: "+t.pitch+", Center Yaw: "+t.yaw+", HFOV: "+t.hfov)}E(),Y(),t.roll=0,C.hfov=0,xt=!0,Z=Date.now(),Bt=o.x,zt=o.y,qt=t.yaw,Zt=t.pitch,k.classList.add("pnlm-grabbing"),k.classList.remove("pnlm-grab"),N("mousedown",e),z()}}function Xt(e){t.minHfov===t.hfov?X.setHfov(Ct,1e3):(e=Lt(e),X.lookAt(e[0],e[1],t.minHfov,1e3))}function Lt(e){var d=et(e);e=M.getCanvas();var v=e.clientWidth,_=e.clientHeight;e=d.x/v*2-1;var _=(1-d.y/_*2)*_/v,o=1/Math.tan(t.hfov*Math.PI/360),i=Math.sin(t.pitch*Math.PI/180),c=Math.cos(t.pitch*Math.PI/180),d=o*c-_*i,v=Math.sqrt(e*e+d*d),_=180*Math.atan((_*c+o*i)/v)/Math.PI;return e=180*Math.atan2(e/v,d/v)/Math.PI+t.yaw,-180>e&&(e+=360),180<e&&(e-=360),[_,e]}function It(e){if(xt&&G){Z=Date.now();var i=M.getCanvas(),o=i.clientWidth,i=i.clientHeight;e=et(e);var c=180*(Math.atan(Bt/o*2-1)-Math.atan(e.x/o*2-1))/Math.PI*t.hfov/90+qt;C.yaw=(c-t.yaw)%360*.2,t.yaw=c,o=360*Math.atan(Math.tan(t.hfov/360*Math.PI)*i/o)/Math.PI,o=180*(Math.atan(e.y/i*2-1)-Math.atan(zt/i*2-1))/Math.PI*o/90+Zt,C.pitch=.2*(o-t.pitch),t.pitch=o}}function Rt(e){xt&&(xt=!1,15<Date.now()-Z&&(C.pitch=C.yaw=0),k.classList.add("pnlm-grab"),k.classList.remove("pnlm-grabbing"),Z=Date.now(),N("mouseup",e))}function kt(e){if(G&&t.draggable){E(),Y(),t.roll=0,C.hfov=0;var o=et(e.targetTouches[0]);if(Bt=o.x,zt=o.y,e.targetTouches.length==2){var i=et(e.targetTouches[1]);Bt+=.5*(i.x-o.x),zt+=.5*(i.y-o.y),Gt=Math.sqrt((o.x-i.x)*(o.x-i.x)+(o.y-i.y)*(o.y-i.y))}xt=!0,Z=Date.now(),qt=t.yaw,Zt=t.pitch,N("touchstart",e),z()}}function _t(e){if(t.draggable&&(e.preventDefault(),G&&(Z=Date.now()),xt&&G)){var o=et(e.targetTouches[0]),i=o.x,c=o.y;e.targetTouches.length==2&&Gt!=-1&&(e=et(e.targetTouches[1]),i+=.5*(e.x-o.x),c+=.5*(e.y-o.y),o=Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y)),x(t.hfov+.1*(Gt-o)),Gt=o),o=t.hfov/360*t.touchPanSpeedCoeffFactor,i=(Bt-i)*o+qt,C.yaw=(i-t.yaw)%360*.2,t.yaw=i,c=(c-zt)*o+Zt,C.pitch=.2*(c-t.pitch),t.pitch=c}}function Ut(){xt=!1,150<Date.now()-Z&&(C.pitch=C.yaw=0),Gt=-1,Z=Date.now(),N("touchend",event)}function B(e){e.pointerType=="touch"&&G&&t.draggable&&(Et.push(e.pointerId),Dt.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=Dt,kt(e),e.preventDefault())}function h(e){if(e.pointerType=="touch"&&t.draggable){for(var o=0;o<Et.length;o++)if(e.pointerId==Et[o]){Dt[o].clientX=e.clientX,Dt[o].clientY=e.clientY,e.targetTouches=Dt,_t(e),e.preventDefault();break}}}function n(e){if(e.pointerType=="touch"){for(var o=!1,i=0;i<Et.length;i++)e.pointerId==Et[i]&&(Et[i]=w),Et[i]&&(o=!0);o||(Et=[],Dt=[],Ut()),e.preventDefault()}}function ot(e){G&&(t.mouseZoom!="fullscreenonly"||Nt)&&(e.preventDefault(),E(),Z=Date.now(),e.wheelDeltaY?(x(t.hfov-.05*e.wheelDeltaY),C.hfov=0>e.wheelDelta?1:-1):e.wheelDelta?(x(t.hfov-.05*e.wheelDelta),C.hfov=0>e.wheelDelta?1:-1):e.detail&&(x(t.hfov+1.5*e.detail),C.hfov=0<e.detail?1:-1),z())}function nt(e){E(),Z=Date.now(),Y(),t.roll=0;var o=e.which||e.keycode;0>t.capturedKeyNumbers.indexOf(o)||(e.preventDefault(),o==27?Nt&&s():St(o,!0))}function ct(){for(var e=0;10>e;e++)b[e]=!1}function Q(e){var o=e.which||e.keycode;0>t.capturedKeyNumbers.indexOf(o)||(e.preventDefault(),St(o,!1))}function St(e,o){var i=!1;switch(e){case 109:case 189:case 17:case 173:b[0]!=o&&(i=!0),b[0]=o;break;case 107:case 187:case 16:case 61:b[1]!=o&&(i=!0),b[1]=o;break;case 38:b[2]!=o&&(i=!0),b[2]=o;break;case 87:b[6]!=o&&(i=!0),b[6]=o;break;case 40:b[3]!=o&&(i=!0),b[3]=o;break;case 83:b[7]!=o&&(i=!0),b[7]=o;break;case 37:b[4]!=o&&(i=!0),b[4]=o;break;case 65:b[8]!=o&&(i=!0),b[8]=o;break;case 39:b[5]!=o&&(i=!0),b[5]=o;break;case 68:b[9]!=o&&(i=!0),b[9]=o}i&&o&&(dt=typeof performance<"u"&&performance.now()?performance.now():Date.now(),z())}function yt(){if(G){var e=!1,o=t.pitch,i=t.yaw,c=t.hfov,d;d=typeof performance<"u"&&performance.now()?performance.now():Date.now(),dt===w&&(dt=d);var v=(d-dt)*t.hfov/1700,v=Math.min(v,1);if(b[0]&&t.keyboardZoom===!0&&(x(t.hfov+(.8*C.hfov+.5)*v),e=!0),b[1]&&t.keyboardZoom===!0&&(x(t.hfov+(.8*C.hfov-.2)*v),e=!0),(b[2]||b[6])&&(t.pitch+=(.8*C.pitch+.2)*v,e=!0),(b[3]||b[7])&&(t.pitch+=(.8*C.pitch-.2)*v,e=!0),(b[4]||b[8])&&(t.yaw+=(.8*C.yaw-.2)*v,e=!0),(b[5]||b[9])&&(t.yaw+=(.8*C.yaw+.2)*v,e=!0),e&&(Z=Date.now()),t.autoRotate){if(.001<d-dt){var e=(d-dt)/1e3,_=(C.yaw/e*v-.2*t.autoRotate)*e,_=(0<-t.autoRotate?1:-1)*Math.min(Math.abs(t.autoRotate*e),Math.abs(_));t.yaw+=_}t.autoRotateStopDelay&&(t.autoRotateStopDelay-=d-dt,0>=t.autoRotateStopDelay&&(t.autoRotateStopDelay=!1,st=t.autoRotate,t.autoRotate=0))}V.pitch&&(p("pitch"),o=t.pitch),V.yaw&&(p("yaw"),i=t.yaw),V.hfov&&(p("hfov"),c=t.hfov),0<v&&!t.autoRotate&&(e=1-t.friction,b[4]||b[5]||b[8]||b[9]||V.yaw||(t.yaw+=C.yaw*v*e),b[2]||b[3]||b[6]||b[7]||V.pitch||(t.pitch+=C.pitch*v*e),b[0]||b[1]||V.hfov||x(t.hfov+C.hfov*v*e)),dt=d,0<v&&(C.yaw=.8*C.yaw+(t.yaw-i)/v*.2,C.pitch=.8*C.pitch+(t.pitch-o)/v*.2,C.hfov=.8*C.hfov+(t.hfov-c)/v*.2,o=t.autoRotate?Math.abs(t.autoRotate):5,C.yaw=Math.min(o,Math.max(C.yaw,-o)),C.pitch=Math.min(o,Math.max(C.pitch,-o)),C.hfov=Math.min(o,Math.max(C.hfov,-o))),b[0]&&b[1]&&(C.hfov=0),(b[2]||b[6])&&(b[3]||b[7])&&(C.pitch=0),(b[4]||b[8])&&(b[5]||b[9])&&(C.yaw=0)}}function p(e){var o=V[e],i=Math.min(1,Math.max((Date.now()-o.startTime)/1e3/(o.duration/1e3),0)),i=o.startPosition+t.animationTimingFunction(i)*(o.endPosition-o.startPosition);(o.endPosition>o.startPosition&&i>=o.endPosition||o.endPosition<o.startPosition&&i<=o.endPosition||o.endPosition===o.startPosition)&&(i=o.endPosition,C[e]=0,delete V[e]),t[e]=i}function U(){l("resize")}function z(){te||(te=!0,gt())}function gt(){if(!re)if(Ft(),jt&&clearTimeout(jt),xt||rt===!0)requestAnimationFrame(gt);else if(b[0]||b[1]||b[2]||b[3]||b[4]||b[5]||b[6]||b[7]||b[8]||b[9]||t.autoRotate||V.pitch||V.yaw||V.hfov||.01<Math.abs(C.yaw)||.01<Math.abs(C.pitch)||.01<Math.abs(C.hfov))yt(),0<=t.autoRotateInactivityDelay&&st&&Date.now()-Z>t.autoRotateInactivityDelay&&!t.autoRotate&&(t.autoRotate=st,X.lookAt(Ht,w,Ct,3e3)),requestAnimationFrame(gt);else if(M&&(M.isLoading()||t.dynamic===!0&&Jt))requestAnimationFrame(gt);else{N("animatefinished",{pitch:X.getPitch(),yaw:X.getYaw(),hfov:X.getHfov()}),te=!1,dt=w;var e=t.autoRotateInactivityDelay-(Date.now()-Z);0<e?jt=setTimeout(function(){t.autoRotate=st,X.lookAt(Ht,w,Ct,3e3),z()},e):0<=t.autoRotateInactivityDelay&&st&&(t.autoRotate=st,X.lookAt(Ht,w,Ct,3e3),z())}}function Ft(){var e;if(G){var o=M.getCanvas();t.autoRotate!==!1&&(360<t.yaw?t.yaw-=360:-360>t.yaw&&(t.yaw+=360)),e=t.yaw;var i=0;if(t.avoidShowingBackground){var c=t.hfov/2,d=180*Math.atan2(Math.tan(c/180*Math.PI),o.width/o.height)/Math.PI;t.vaov>t.haov?Math.min(Math.cos((t.pitch-c)/180*Math.PI),Math.cos((t.pitch+c)/180*Math.PI)):i=c*(1-Math.min(Math.cos((t.pitch-d)/180*Math.PI),Math.cos((t.pitch+d)/180*Math.PI)))}var c=t.maxYaw-t.minYaw,d=-180,v=180;360>c&&(d=t.minYaw+t.hfov/2+i,v=t.maxYaw-t.hfov/2-i,c<t.hfov&&(d=v=(d+v)/2),t.yaw=Math.max(d,Math.min(v,t.yaw))),t.autoRotate===!1&&(360<t.yaw?t.yaw-=360:-360>t.yaw&&(t.yaw+=360)),t.autoRotate!==!1&&e!=t.yaw&&dt!==w&&(t.autoRotate*=-1),e=2*Math.atan(Math.tan(t.hfov/180*Math.PI*.5)/(o.width/o.height))/Math.PI*180,o=t.minPitch+e/2,i=t.maxPitch-e/2,t.maxPitch-t.minPitch<e&&(o=i=(o+i)/2),isNaN(o)&&(o=-90),isNaN(i)&&(i=90),t.pitch=Math.max(o,Math.min(i,t.pitch)),M.render(t.pitch*Math.PI/180,t.yaw*Math.PI/180,t.hfov*Math.PI/180,{roll:t.roll*Math.PI/180}),t.hotSpots.forEach(L),t.compass&&(Yt.style.transform="rotate("+(-t.yaw-t.northOffset)+"deg)",Yt.style.webkitTransform="rotate("+(-t.yaw-t.northOffset)+"deg)")}}function at(e,o,i,c){this.w=e,this.x=o,this.y=i,this.z=c}function Tt(e){var o;o=e.alpha;var i=e.beta;e=e.gamma,i=[i?i*Math.PI/180/2:0,e?e*Math.PI/180/2:0,o?o*Math.PI/180/2:0],o=[Math.cos(i[0]),Math.cos(i[1]),Math.cos(i[2])],i=[Math.sin(i[0]),Math.sin(i[1]),Math.sin(i[2])],o=new at(o[0]*o[1]*o[2]-i[0]*i[1]*i[2],i[0]*o[1]*o[2]-o[0]*i[1]*i[2],o[0]*i[1]*o[2]+i[0]*o[1]*i[2],o[0]*o[1]*i[2]+i[0]*i[1]*o[2]),o=o.multiply(new at(Math.sqrt(.5),-Math.sqrt(.5),0,0)),i=J.orientation?-J.orientation*Math.PI/180/2:0,o=o.multiply(new at(Math.cos(i),0,-Math.sin(i),0)).toEulerAngles(),typeof rt=="number"&&10>rt?rt+=1:rt===10?(ae=o[2]/Math.PI*180+t.yaw,rt=!0,requestAnimationFrame(gt)):(t.pitch=o[0]/Math.PI*180,t.roll=-o[1]/Math.PI*180,t.yaw=-o[2]/Math.PI*180+ae)}function At(){try{var e={};t.horizonPitch!==w&&(e.horizonPitch=t.horizonPitch*Math.PI/180),t.horizonRoll!==w&&(e.horizonRoll=t.horizonRoll*Math.PI/180),t.backgroundColor!==w&&(e.backgroundColor=t.backgroundColor),M.init($,t.type,t.dynamic,t.haov*Math.PI/180,t.vaov*Math.PI/180,t.vOffset*Math.PI/180,ut,e),t.dynamic!==!0&&($=w)}catch(o){if(o.type=="webgl error"||o.type=="no webgl")H();else if(o.type=="webgl size error")H(t.strings.textureSizeError.replace("%s",o.width).replace("%s",o.maxWidth));else throw H(t.strings.unknownError),o}}function ut(){if(t.sceneFadeDuration&&M.fadeImg!==w){M.fadeImg.style.opacity=0;var e=M.fadeImg;delete M.fadeImg,setTimeout(function(){q.removeChild(e),N("scenechangefadedone")},t.sceneFadeDuration)}Yt.style.display=t.compass?"inline":"none",a(),g.load.box.style.display="none",P!==w&&(q.removeChild(P),P=w),G=!0,N("load"),z()}function Wt(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var o=f.createElement("div");o.className="pnlm-hotspot-base",o.className=e.cssClass?o.className+(" "+e.cssClass):o.className+(" pnlm-hotspot pnlm-sprite pnlm-"+O(e.type));var i=f.createElement("span");e.text&&(i.innerHTML=O(e.text));var c;if(e.video){c=f.createElement("video");var d=e.video;t.basePath&&!Mt(d)&&(d=t.basePath+d),c.src=F(d),c.controls=!0,c.style.width=e.width+"px",q.appendChild(o),i.appendChild(c)}else if(e.image){d=e.image,t.basePath&&!Mt(d)&&(d=t.basePath+d),c=f.createElement("a"),c.href=F(e.URL?e.URL:d,!0),c.target="_blank",i.appendChild(c);var v=f.createElement("img");v.src=F(d),v.style.width=e.width+"px",v.style.paddingTop="5px",q.appendChild(o),c.appendChild(v),i.style.maxWidth="initial"}else if(e.URL){if(c=f.createElement("a"),c.href=F(e.URL,!0),e.attributes)for(d in e.attributes)c.setAttribute(d,e.attributes[d]);else c.target="_blank";q.appendChild(c),o.className+=" pnlm-pointer",i.className+=" pnlm-pointer",c.appendChild(o)}else e.sceneId&&(o.onclick=o.ontouchend=function(){return o.clicked||(o.clicked=!0,I(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},o.className+=" pnlm-pointer",i.className+=" pnlm-pointer"),q.appendChild(o);e.createTooltipFunc?e.createTooltipFunc(o,e.createTooltipArgs):(e.text||e.video||e.image)&&(o.classList.add("pnlm-tooltip"),o.appendChild(i),i.style.width=i.scrollWidth-20+"px",i.style.marginLeft=-(i.scrollWidth-o.offsetWidth)/2+"px",i.style.marginTop=-i.scrollHeight-12+"px"),e.clickHandlerFunc&&(o.addEventListener("click",function(_){e.clickHandlerFunc(_,e.clickHandlerArgs)},"false"),o.className+=" pnlm-pointer",i.className+=" pnlm-pointer"),e.div=o}function a(){ee||(t.hotSpots?(t.hotSpots=t.hotSpots.sort(function(e,o){return e.pitch<o.pitch}),t.hotSpots.forEach(Wt)):t.hotSpots=[],ee=!0,t.hotSpots.forEach(L))}function r(){var e=t.hotSpots;if(ee=!1,delete t.hotSpots,e)for(var o=0;o<e.length;o++){var i=e[o].div;if(i){for(;i.parentNode&&i.parentNode!=q;)i=i.parentNode;q.removeChild(i)}delete e[o].div}}function L(e){var o=Math.sin(e.pitch*Math.PI/180),i=Math.cos(e.pitch*Math.PI/180),c=Math.sin(t.pitch*Math.PI/180),d=Math.cos(t.pitch*Math.PI/180),v=Math.cos((-e.yaw+t.yaw)*Math.PI/180),_=o*c+i*v*d;if(90>=e.yaw&&-90<e.yaw&&0>=_||(90<e.yaw||-90>=e.yaw)&&0>=_)e.div.style.visibility="hidden";else{var lt=Math.sin((-e.yaw+t.yaw)*Math.PI/180),K=Math.tan(t.hfov*Math.PI/360);e.div.style.visibility="visible";var j=M.getCanvas(),ht=j.clientWidth,j=j.clientHeight,o=[-ht/K*lt*i/_/2,-ht/K*(o*d-i*v*c)/_/2],i=Math.sin(t.roll*Math.PI/180),c=Math.cos(t.roll*Math.PI/180),o=[o[0]*c-o[1]*i,o[0]*i+o[1]*c];o[0]+=(ht-e.div.offsetWidth)/2,o[1]+=(j-e.div.offsetHeight)/2,ht="translate("+o[0]+"px, "+o[1]+"px) translateZ(9999px) rotate("+t.roll+"deg)",e.scale&&(ht+=" scale("+Ct/t.hfov/_+")"),e.div.style.webkitTransform=ht,e.div.style.MozTransform=ht,e.div.style.transform=ht}}function y(e){t={};var o,i,c="haov vaov vOffset northOffset horizonPitch horizonRoll".split(" ");ft=[];for(o in oe)oe.hasOwnProperty(o)&&(t[o]=oe[o]);for(o in S.default)if(S.default.hasOwnProperty(o))if(o=="strings")for(i in S.default.strings)S.default.strings.hasOwnProperty(i)&&(t.strings[i]=O(S.default.strings[i]));else t[o]=S.default[o],0<=c.indexOf(o)&&ft.push(o);if(e!==null&&e!==""&&S.scenes&&S.scenes[e]){var d=S.scenes[e];for(o in d)if(d.hasOwnProperty(o))if(o=="strings")for(i in d.strings)d.strings.hasOwnProperty(i)&&(t.strings[i]=O(d.strings[i]));else t[o]=d[o],0<=c.indexOf(o)&&ft.push(o);t.scene=e}for(o in S)if(S.hasOwnProperty(o))if(o=="strings")for(i in S.strings)S.strings.hasOwnProperty(i)&&(t.strings[i]=O(S.strings[i]));else t[o]=S[o],0<=c.indexOf(o)&&ft.push(o)}function u(e){if((e=e||!1)&&"preview"in t){var o=t.preview;t.basePath&&!Mt(o)&&(o=t.basePath+o),P=f.createElement("div"),P.className="pnlm-preview-img",P.style.backgroundImage="url('"+F(o).replace(/"/g,"%22").replace(/'/g,"%27")+"')",q.appendChild(P)}var o=t.title,i=t.author;e&&("previewTitle"in t&&(t.title=t.previewTitle),"previewAuthor"in t&&(t.author=t.previewAuthor)),t.hasOwnProperty("title")||(g.title.innerHTML=""),t.hasOwnProperty("author")||(g.author.innerHTML=""),t.hasOwnProperty("title")||t.hasOwnProperty("author")||(g.container.style.display="none"),T.load.innerHTML="<p>"+t.strings.loadButtonLabel+"</p>",g.load.boxp.innerHTML=t.strings.loadingLabel;for(var c in t)if(t.hasOwnProperty(c))switch(c){case"title":g.title.innerHTML=O(t[c]),g.container.style.display="inline";break;case"author":var d=O(t[c]);t.authorURL&&(d=f.createElement("a"),d.href=F(t.authorURL,!0),d.target="_blank",d.innerHTML=O(t[c]),d=d.outerHTML),g.author.innerHTML=t.strings.bylineLabel.replace("%s",d),g.container.style.display="inline";break;case"fallback":d=f.createElement("a"),d.href=F(t[c],!0),d.target="_blank",d.textContent="Click here to view this panorama in an alternative viewer.";var v=f.createElement("p");v.textContent="Your browser does not support WebGL.",v.appendChild(f.createElement("br")),v.appendChild(d),g.errorMsg.innerHTML="",g.errorMsg.appendChild(v);break;case"hfov":x(Number(t[c]));break;case"autoLoad":t[c]===!0&&M===w&&(g.load.box.style.display="inline",T.load.style.display="none",bt());break;case"showZoomCtrl":T.zoom.style.display=t[c]&&t.showControls!=!1?"block":"none";break;case"showFullscreenCtrl":T.fullscreen.style.display=t[c]&&t.showControls!=!1&&("fullscreen"in f||"mozFullScreen"in f||"webkitIsFullScreen"in f||"msFullscreenElement"in f)?"block":"none";break;case"hotSpotDebug":ne.style.display=t[c]?"block":"none";break;case"showControls":t[c]||(T.orientation.style.display="none",T.zoom.style.display="none",T.fullscreen.style.display="none");break;case"orientationOnByDefault":t[c]&&W()}e&&(o?t.title=o:delete t.title,i?t.author=i:delete t.author)}function s(){if(G&&!Vt)if(Nt)f.exitFullscreen?f.exitFullscreen():f.mozCancelFullScreen?f.mozCancelFullScreen():f.webkitCancelFullScreen?f.webkitCancelFullScreen():f.msExitFullscreen&&f.msExitFullscreen();else try{A.requestFullscreen?A.requestFullscreen():A.mozRequestFullScreen?A.mozRequestFullScreen():A.msRequestFullscreen?A.msRequestFullscreen():A.webkitRequestFullScreen()}catch{}}function l(e){f.fullscreenElement||f.fullscreen||f.mozFullScreen||f.webkitIsFullScreen||f.msFullscreenElement?(T.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),Nt=!0):(T.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),Nt=!1),e!=="resize"&&N("fullscreenchange",Nt),M.resize(),x(t.hfov),z()}function R(e){var o=t.minHfov;if(t.type=="multires"&&M&&!t.multiResMinHfov&&(o=Math.min(o,M.getCanvas().width/(t.multiRes.cubeResolution/90*.9))),o>t.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),t.hfov;var i=t.hfov,i=e<o?o:e>t.maxHfov?t.maxHfov:e;return t.avoidShowingBackground&&M&&(e=M.getCanvas(),i=Math.min(i,360*Math.atan(Math.tan((t.maxPitch-t.minPitch)/360*Math.PI)/e.height*e.width)/Math.PI)),i}function x(e){t.hfov=R(e),N("zoomchange",t.hfov)}function E(){V={},st=t.autoRotate?t.autoRotate:st,t.autoRotate=!1}function D(){Vt&&(g.load.box.style.display="none",g.errorMsg.style.display="none",Vt=!1,q.style.display="block",N("errorcleared")),G=!1,T.load.style.display="none",g.load.box.style.display="inline",bt()}function I(e,o,i,c,d){G||(d=!0),G=!1,V={};var v,_;if(t.sceneFadeDuration&&!d&&(v=M.render(t.pitch*Math.PI/180,t.yaw*Math.PI/180,t.hfov*Math.PI/180,{returnImage:!0}),v!==w)){d=new Image,d.className="pnlm-fade-img",d.style.transition="opacity "+t.sceneFadeDuration/1e3+"s",d.style.width="100%",d.style.height="100%",d.onload=function(){I(e,o,i,c,!0)},d.src=v,q.appendChild(d),M.fadeImg=d;return}d=o==="same"?t.pitch:o,v=i==="same"?t.yaw:i==="sameAzimuth"?t.yaw+(t.northOffset||0)-(S.scenes[e].northOffset||0):i,_=c==="same"?t.hfov:c,r(),y(e),C.yaw=C.pitch=C.hfov=0,u(),d!==w&&(t.pitch=d),v!==w&&(t.yaw=v),_!==w&&(t.hfov=_),N("scenechange",e),D()}function Y(){J.removeEventListener("deviceorientation",Tt),T.orientation.classList.remove("pnlm-orientation-button-active"),rt=!1}function W(){typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(e){e=="granted"&&(rt=1,J.addEventListener("deviceorientation",Tt),T.orientation.classList.add("pnlm-orientation-button-active"))}):(rt=1,J.addEventListener("deviceorientation",Tt),T.orientation.classList.add("pnlm-orientation-button-active"))}function O(e){return S.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split(`
`).join("<br>"):String(e).split(`
`).join("<br>")}function F(e,o){try{var i=decodeURIComponent(m(e)).replace(/[^\w:]/g,"").toLowerCase()}catch{return"about:blank"}return i.indexOf("javascript:")===0||i.indexOf("vbscript:")===0?(console.log("Script URL removed."),"about:blank"):o&&i.indexOf("data:")===0?(console.log("Data URI removed from link."),"about:blank"):e}function m(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,function(o,i){return i=i.toLowerCase(),i==="colon"?":":i.charAt(0)==="#"?i.charAt(1)==="x"?String.fromCharCode(parseInt(i.substring(2),16)):String.fromCharCode(+i.substring(1)):""})}function N(e){if(e in tt)for(var o=tt[e].length;0<o;o--)tt[e][tt[e].length-o].apply(null,[].slice.call(arguments,1))}var X=this,t,M,P,xt=!1,Z=Date.now(),Bt=0,zt=0,Gt=-1,qt=0,Zt=0,b=Array(10),Nt=!1,G,Vt=!1,Qt=!1,$,dt,C={yaw:0,pitch:0,hfov:0},te=!1,rt=!1,ae=0,jt,st=0,Ct,Ht,V={},tt={},ft=[],Jt=!1,ee=!1,re=!1,oe={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:w,maxPitch:w,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:w,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(e){return .5>e?2*e*e:-1+(4-2*e)*e},draggable:!0,disableKeyboardCtrl:!1,crossOrigin:"anonymous",touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console."}};A=typeof A=="string"?f.getElementById(A):A,A.classList.add("pnlm-container"),A.tabIndex=0;var k=f.createElement("div");k.className="pnlm-ui",A.appendChild(k);var q=f.createElement("div");q.className="pnlm-render-container",A.appendChild(q);var it=f.createElement("div");it.className="pnlm-dragfix",k.appendChild(it);var wt=f.createElement("span");wt.className="pnlm-about-msg",wt.innerHTML='<a href="https://pannellum.org/" target="_blank">Pannellum</a> 2.5.6',k.appendChild(wt),it.addEventListener("contextmenu",pt);var g={},ne=f.createElement("div");ne.className="pnlm-sprite pnlm-hot-spot-debug-indicator",k.appendChild(ne),g.container=f.createElement("div"),g.container.className="pnlm-panorama-info",g.title=f.createElement("div"),g.title.className="pnlm-title-box",g.container.appendChild(g.title),g.author=f.createElement("div"),g.author.className="pnlm-author-box",g.container.appendChild(g.author),k.appendChild(g.container),g.load={},g.load.box=f.createElement("div"),g.load.box.className="pnlm-load-box",g.load.boxp=f.createElement("p"),g.load.box.appendChild(g.load.boxp),g.load.lbox=f.createElement("div"),g.load.lbox.className="pnlm-lbox",g.load.lbox.innerHTML='<div class="pnlm-loading"></div>',g.load.box.appendChild(g.load.lbox),g.load.lbar=f.createElement("div"),g.load.lbar.className="pnlm-lbar",g.load.lbarFill=f.createElement("div"),g.load.lbarFill.className="pnlm-lbar-fill",g.load.lbar.appendChild(g.load.lbarFill),g.load.box.appendChild(g.load.lbar),g.load.msg=f.createElement("p"),g.load.msg.className="pnlm-lmsg",g.load.box.appendChild(g.load.msg),k.appendChild(g.load.box),g.errorMsg=f.createElement("div"),g.errorMsg.className="pnlm-error-msg pnlm-info-box",k.appendChild(g.errorMsg);var T={};T.container=f.createElement("div"),T.container.className="pnlm-controls-container",k.appendChild(T.container),T.load=f.createElement("div"),T.load.className="pnlm-load-button",T.load.addEventListener("click",function(){u(),D()}),k.appendChild(T.load),T.zoom=f.createElement("div"),T.zoom.className="pnlm-zoom-controls pnlm-controls",T.zoomIn=f.createElement("div"),T.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",T.zoomIn.addEventListener("click",function(){G&&(x(t.hfov-5),z())}),T.zoom.appendChild(T.zoomIn),T.zoomOut=f.createElement("div"),T.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",T.zoomOut.addEventListener("click",function(){G&&(x(t.hfov+5),z())}),T.zoom.appendChild(T.zoomOut),T.container.appendChild(T.zoom),T.fullscreen=f.createElement("div"),T.fullscreen.addEventListener("click",s),T.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(f.fullscreenEnabled||f.mozFullScreenEnabled||f.webkitFullscreenEnabled||f.msFullscreenEnabled)&&T.container.appendChild(T.fullscreen),T.orientation=f.createElement("div"),T.orientation.addEventListener("click",function(e){rt?Y():W()}),T.orientation.addEventListener("mousedown",function(e){e.stopPropagation()}),T.orientation.addEventListener("touchstart",function(e){e.stopPropagation()}),T.orientation.addEventListener("pointerdown",function(e){e.stopPropagation()}),T.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var ie=!1;J.DeviceOrientationEvent&&location.protocol=="https:"&&0<=navigator.userAgent.toLowerCase().indexOf("mobi")&&(T.container.appendChild(T.orientation),ie=!0);var Yt=f.createElement("div");Yt.className="pnlm-compass pnlm-controls pnlm-control",k.appendChild(Yt),S.firstScene?y(S.firstScene):S.default&&S.default.firstScene?y(S.default.firstScene):y(null),u(!0);var Et=[],Dt=[];at.prototype.multiply=function(e){return new at(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},at.prototype.toEulerAngles=function(){var e=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),o=Math.asin(2*(this.w*this.y-this.z*this.x)),i=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z));return[e,o,i]},this.isLoaded=function(){return!!G},this.getPitch=function(){return t.pitch},this.setPitch=function(e,o,i,c){return Z=Date.now(),1e-6>=Math.abs(e-t.pitch)?(typeof i=="function"&&i(c),this):((o=o==w?1e3:Number(o))?(V.pitch={startTime:Date.now(),startPosition:t.pitch,endPosition:e,duration:o},typeof i=="function"&&setTimeout(function(){i(c)},o)):t.pitch=e,z(),this)},this.getPitchBounds=function(){return[t.minPitch,t.maxPitch]},this.setPitchBounds=function(e){return t.minPitch=Math.max(-90,Math.min(e[0],90)),t.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return(t.yaw+540)%360-180},this.setYaw=function(e,o,i,c){return Z=Date.now(),1e-6>=Math.abs(e-t.yaw)?(typeof i=="function"&&i(c),this):(o=o==w?1e3:Number(o),e=(e+180)%360-180,o?(180<t.yaw-e?e+=360:180<e-t.yaw&&(e-=360),V.yaw={startTime:Date.now(),startPosition:t.yaw,endPosition:e,duration:o},typeof i=="function"&&setTimeout(function(){i(c)},o)):t.yaw=e,z(),this)},this.getYawBounds=function(){return[t.minYaw,t.maxYaw]},this.setYawBounds=function(e){return t.minYaw=Math.max(-360,Math.min(e[0],360)),t.maxYaw=Math.max(-360,Math.min(e[1],360)),this},this.getHfov=function(){return t.hfov},this.setHfov=function(e,o,i,c){return Z=Date.now(),1e-6>=Math.abs(e-t.hfov)?(typeof i=="function"&&i(c),this):((o=o==w?1e3:Number(o))?(V.hfov={startTime:Date.now(),startPosition:t.hfov,endPosition:R(e),duration:o},typeof i=="function"&&setTimeout(function(){i(c)},o)):x(e),z(),this)},this.getHfovBounds=function(){return[t.minHfov,t.maxHfov]},this.setHfovBounds=function(e){return t.minHfov=Math.max(0,e[0]),t.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,o,i,c,d,v){return c=c==w?1e3:Number(c),e!==w&&1e-6<Math.abs(e-t.pitch)&&(this.setPitch(e,c,d,v),d=w),o!==w&&1e-6<Math.abs(o-t.yaw)&&(this.setYaw(o,c,d,v),d=w),i!==w&&1e-6<Math.abs(i-t.hfov)&&(this.setHfov(i,c,d,v),d=w),typeof d=="function"&&d(v),this},this.getNorthOffset=function(){return t.northOffset},this.setNorthOffset=function(e){return t.northOffset=Math.min(360,Math.max(0,e)),z(),this},this.getHorizonRoll=function(){return t.horizonRoll},this.setHorizonRoll=function(e){return t.horizonRoll=Math.min(90,Math.max(-90,e)),M.setPose(t.horizonPitch*Math.PI/180,t.horizonRoll*Math.PI/180),z(),this},this.getHorizonPitch=function(){return t.horizonPitch},this.setHorizonPitch=function(e){return t.horizonPitch=Math.min(90,Math.max(-90,e)),M.setPose(t.horizonPitch*Math.PI/180,t.horizonRoll*Math.PI/180),z(),this},this.startAutoRotate=function(e,o){return e=e||st||1,o=o===w?Ht:o,t.autoRotate=e,X.lookAt(o,w,Ct,3e3),z(),this},this.stopAutoRotate=function(){return st=t.autoRotate?t.autoRotate:st,t.autoRotate=!1,t.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){E(),C={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return M},this.setUpdate=function(e){return Jt=e===!0,M===w?Pt():z(),this},this.mouseEventToCoords=function(e){return Lt(e)},this.loadScene=function(e,o,i,c){return G!==!1&&I(e,o,i,c),this},this.getScene=function(){return t.scene},this.addScene=function(e,o){return S.scenes[e]=o,this},this.removeScene=function(e){return t.scene===e||!S.scenes.hasOwnProperty(e)?!1:(delete S.scenes[e],!0)},this.toggleFullscreen=function(){return s(),this},this.getConfig=function(){return t},this.getContainer=function(){return A},this.addHotSpot=function(e,o){if(o===w&&t.scene===w)t.hotSpots.push(e);else{var i=o!==w?o:t.scene;if(S.scenes.hasOwnProperty(i))S.scenes[i].hasOwnProperty("hotSpots")||(S.scenes[i].hotSpots=[],i==t.scene&&(t.hotSpots=S.scenes[i].hotSpots)),S.scenes[i].hotSpots.push(e);else throw"Invalid scene ID!"}return(o===w||t.scene==o)&&(Wt(e),G&&L(e)),this},this.removeHotSpot=function(e,o){if(o===w||t.scene==o){if(!t.hotSpots)return!1;for(var i=0;i<t.hotSpots.length;i++)if(t.hotSpots[i].hasOwnProperty("id")&&t.hotSpots[i].id===e){for(var c=t.hotSpots[i].div;c.parentNode!=q;)c=c.parentNode;return q.removeChild(c),delete t.hotSpots[i].div,t.hotSpots.splice(i,1),!0}}else if(S.scenes.hasOwnProperty(o)){if(!S.scenes[o].hasOwnProperty("hotSpots"))return!1;for(i=0;i<S.scenes[o].hotSpots.length;i++)if(S.scenes[o].hotSpots[i].hasOwnProperty("id")&&S.scenes[o].hotSpots[i].id===e)return S.scenes[o].hotSpots.splice(i,1),!0}else return!1},this.resize=function(){M&&U()},this.isLoaded=function(){return G},this.isOrientationSupported=function(){return ie||!1},this.stopOrientation=function(){Y()},this.startOrientation=function(){ie&&W()},this.isOrientationActive=function(){return!!rt},this.on=function(e,o){return tt[e]=tt[e]||[],tt[e].push(o),this},this.off=function(e,o){if(!e)return tt={},this;if(o){var i=tt[e].indexOf(o);0<=i&&tt[e].splice(i,1),tt[e].length==0&&delete tt[e]}else delete tt[e];return this},this.destroy=function(){re=!0,clearTimeout(jt),M&&M.destroy(),Qt&&(f.removeEventListener("mousemove",It,!1),f.removeEventListener("mouseup",Rt,!1),A.removeEventListener("mozfullscreenchange",l,!1),A.removeEventListener("webkitfullscreenchange",l,!1),A.removeEventListener("msfullscreenchange",l,!1),A.removeEventListener("fullscreenchange",l,!1),J.removeEventListener("resize",U,!1),J.removeEventListener("orientationchange",U,!1),A.removeEventListener("keydown",nt,!1),A.removeEventListener("keyup",Q,!1),A.removeEventListener("blur",ct,!1),f.removeEventListener("mouseleave",Rt,!1)),A.innerHTML="",A.classList.remove("pnlm-container")}}return{viewer:function(A,S){return new $t(A,S)}}}(window,document);
